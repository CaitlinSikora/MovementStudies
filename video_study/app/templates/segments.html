<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Encode Video</title>
    <style>
      body {
        padding: 0; 
        margin: 0;
      } 
      canvas {
        position:absolute; 
        top:654px; 
        left:40px;
        z-index:100;
      } 
      vid {
        position:relative;
        z-index:-1;
      }
      form {
        position: absolute;
        top: 680px;
      }

    </style>
</head>
<body>
{% extends "base.html" %}
{% block content %}
<div class="flashes">
    {% for message in get_flashed_messages() %}
    <h3>{{ message }}</h3>
    {% endfor %}
</div>

<h2>Encode Movements for Video {{ num }}</h2>
<h3>Please watch the video and add a field for each expressive movement you see in the video.</h3>
<vid></vid>
<form method="POST">
<!-- just to display all potential errors -->
{% if form.errors %}
    <ul class="errors">
        {% for field_name, field_errors in form.errors|dictsort if field_errors %}
            {% for error in field_errors %}
                <li>{{ form[field_name].label }}: {{ error }}</li>
            {% endfor %}
        {% endfor %}
    </ul>
{% endif %}

    <div data-toggle="fieldset" id="phone-fieldset">
         <h3>Movements</h3>
        <table>
            <tr>
                <th>Start Time (s)</th>
                <th>End Time (s)</th>
                <th>Quality</th>
                <th>Emotion</th>
                <th>Body Parts Involved</th>
                <th></th>
            </tr>
            {% for segment in form.segments %}
                <tr data-toggle="fieldset-entry">
                    <td>{{ segment.start_time }}</td>
                    <td>{{ segment.end_time }}</td>
                    <td>{{ segment.laban_effort }}</td>
                    <td>{{ segment.emotion }}</td>
                    <td>{{ segment.body }}</td>
                    <td><button type="button" data-toggle="fieldset-remove-row" id="phone-{{loop.index0}}-remove">- Remove</button></td>
                </tr>
            {% endfor %}
        </table>
        <button type="button" data-toggle="fieldset-add-row"
                                          data-target="#phone-fieldset">+ Add Movement</button>
    </div>
    {{ form.hidden_tag() }}

<!--<h5> <a href="{{ url_for('get_user') }}">Home</a> </h5>-->
<p><input id="submit" type="submit" value="Next Video"><span id='instruct'></span></p>
<!--<p id='submit_button'>{{ form.submit }}</p>-->
</form>


<script src="{{ url_for("static", filename="js/page.js") }}"></script>
<script>
var vid;
var markings = [0,{{ duration }}];
console.log(markings);

function setup() {
  // specify multiple formats for different browsers
  vid = createVideo('{{ this_video }}');
  vid.show();
  vid.showControls();
  vid.volume(0);
  vid.size(600,400);
  vid.position(40, 260);
  console.log(vid.position().y);
  console.log(vid.size());
  createCanvas(600,20);          
                  
}

function draw() {
  //console.log(vid.time());
  background(255);
  //image(vid,0,0); // draw the video frame to canvas
  stroke('#1474cd');
  strokeWeight(2);
  line(108,9,412,9);
  strokeWeight(6);
  for (var i=0; i<markings.length;i++){
    //console.log(markings[i]);
    line(timeTransform(markings[i]),7,timeTransform(markings[i]),13);
  }
}

function timeTransform(time){
  var fraction = time/vid.duration();
  var posTime = 108 + fraction*(412-108);
  return posTime;
}
 
</script>
<script src="static/js/p5.js" type="text/javascript"></script>
<script src="static/js/p5.dom.js" type="text/javascript"></script>
{% endblock %}
</body>
</html>